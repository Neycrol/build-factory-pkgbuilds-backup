# Maintainer: Misaka <misaka@misaka.io>
# Generated by Gemini CLI - Physical Limit Foundry

pkgname=cursor-agent-bin
_pkgver=2025.12.17
_commit=996666f
pkgver=${_pkgver//-/_}
pkgrel=1
pkgdesc="CLI agent for Cursor - The AI Code Editor (Binary Version)"
arch=('x86_64')
url="https://cursor.com"
license=('custom:cursor')
depends=('glibc' 'gcc-libs')
makedepends=('patchelf')
options=('!strip' '!debug')
source=("agent-cli-package-${pkgver}.tar.gz::https://downloads.cursor.com/lab/${_pkgver}-${_commit}/linux/x64/agent-cli-package.tar.gz")
sha256sums=('749e3956802c4ab7d30addc6752fedf607d3e7289ef938c974d19dd99ad01002')

package() {
    cd "$srcdir/dist-package"

    install -d "$pkgdir/usr/lib/cursor-agent"
    cp -r . "$pkgdir/usr/lib/cursor-agent/"

    # Create symlink to the main executable
    install -d "$pkgdir/usr/bin"
    ln -s /usr/lib/cursor-agent/cursor-agent "$pkgdir/usr/bin/cursor-agent"

    # Set permissions
    chmod +x "$pkgdir/usr/lib/cursor-agent/cursor-agent"
    chmod +x "$pkgdir/usr/lib/cursor-agent/node"
    chmod +x "$pkgdir/usr/lib/cursor-agent/rg"

    # Physical Limit Optimization: Force RPATH to God Mode libraries if they exist
    # Based on HANDOVER_BUILD_FACTORY_MASTER.md
    local god_lib="/opt/gcc-git-god/lib64"
    if [ -d "$god_lib" ]; then
        echo "â–· Applying God Mode RPATH optimization..."
        patchelf --set-rpath "$god_lib" "$pkgdir/usr/lib/cursor-agent/node"
        patchelf --set-rpath "$god_lib" "$pkgdir/usr/lib/cursor-agent/rg"
    fi
}
