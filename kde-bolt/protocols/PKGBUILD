# Maintainer: neycrol <your_email@example.com>
pkgname=plasma-wayland-protocols-git
pkgver=1.19.0.r9.g57313b8
pkgrel=1
pkgdesc="Plasma Specific Protocols for Wayland (Git Master) - The Rosetta Stone for your KWin"
arch=('any') # XML æ–‡ä»¶ä¸åˆ†æ¶æ„
url="https://invent.kde.org/libraries/plasma-wayland-protocols"
license=('LGPL')
depends=('wayland-protocols')
makedepends=('git' 'extra-cmake-modules' 'cmake' 'ninja' 'wayland')
provides=('plasma-wayland-protocols')
conflicts=('plasma-wayland-protocols')
source=("git+https://invent.kde.org/libraries/plasma-wayland-protocols.git")
sha256sums=('SKIP')

pkgver() {
  cd plasma-wayland-protocols
  # è‡ªåŠ¨è¿½è¸ªæœ€æ–° commit
  git describe --long --tags | sed 's/^v//;s/\([^-]*-g\)/r\1/;s/-/./g'
}

build() {
  # ğŸ”¥ã€æ ¸å¿ƒä¿®å¤ã€‘ğŸ”¥
  # è¿™æ˜¯ä¸€ä¸ªçº¯åè®®åŒ…ï¼ˆåªæœ‰ XML å’Œå¤´æ–‡ä»¶ï¼‰ï¼Œä¸äº§ç”ŸäºŒè¿›åˆ¶ä»£ç ã€‚
  # å¼ºè¡Œä¸Š Native/LTO ä¼šå¯¼è‡´ CMake ç¼–è¯‘å™¨æ£€æŸ¥å¤±è´¥ï¼ˆUndefined reference to mainï¼‰ã€‚
  # æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦æ¸…ç©ºæ‰€æœ‰ç¥çº§å‚æ•°ï¼Œå›å½’å¹³æ·¡ã€‚
  
  unset CFLAGS
  unset CXXFLAGS
  unset LDFLAGS
  unset KCFLAGS
  unset KCPPFLAGS
  
  # æˆ–è€…é‡ç½®ä¸ºé»˜è®¤å®‰å…¨å€¼
  export CFLAGS="-g -O2"
  export CXXFLAGS="-g -O2"
  
  # æ­£å¸¸çš„ CMake æµç¨‹
  cmake -B build -S plasma-wayland-protocols -G Ninja \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DCMAKE_BUILD_TYPE=Release
  
  cmake --build build
}
package() {
  DESTDIR="$pkgdir" cmake --install build
}
